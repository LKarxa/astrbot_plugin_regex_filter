# RegexFilter 插件

一个使用正则表达式处理LLM消息的AstrBot插件，可以对LLM回复进行替换、删除、增添等操作。

本插件由AI生成，所以具体使用方法还在摸索中。推荐添加方式是本人已经摸索出的正确的添加方式，没有推荐的则是我还不知道（

## 功能介绍

RegexFilter插件能够拦截并处理大语言模型(LLM)的响应消息，通过预设的正则表达式规则对消息内容进行修改，包括：

- **替换**：将匹配的文本替换为指定内容（推荐使用指令添加）
- **删除**：删除匹配的文本 (推荐使用webui添加）
- **后添加**：在匹配的文本后添加内容（推荐使用指令添加）
- **前添加**：在匹配的文本前添加内容（推荐使用指令添加）


## 使用方法

### 通过WebUI配置

1. 在AstrBot的WebUI中，找到"插件管理"页面
2. 找到"regex_filter"插件，点击"管理"
3. 在配置界面可以直接修改所有配置项：
   - 启用/禁用插件
   - 管理正则表达式规则
   - 设置调试模式
   - 配置消息末尾标记

### 通过命令行

插件提供了多个命令用于管理规则：

#### 基本指令

- `/regex_list` - 显示当前所有规则
- `/regex_status` - 显示插件状态信息
- `/regex_toggle` - 切换插件启用/禁用状态

#### 规则管理

- `/regex_add [pattern] [replacement] [action]` - 添加新规则
  - `pattern`: 正则表达式模式
  - `replacement`: 替换/添加的内容
  - `action`: 操作类型，可以是`replace`(替换)、`delete`(删除)、`append`(后添加)或`prepend`(前添加)
  
  例如：
  ```
  /regex_add 不可以 可以 replace
  /regex_add $ (已处理) append
  /regex_add ^ (已添加） prepend
  ```

- `/regex_remove [index]` - 删除指定索引的规则
  - `index`: 规则的索引（从1开始）

#### 规则测试

- `/regex_test [text]` - 测试规则对指定文本的效果
  - `text`: 要测试的文本内容

  例如：
  ```
  /regex_test "这个问题不可以解决"
  ```

## 默认规则

插件预设了几个示例规则：

1. 将"不可以"替换为"可以"
2. 将"糟糕"、"坏"或"不好"替换为"好"
3. 删除所有"问题"字样
4. 在消息末尾添加"(已通过正则处理)"标记


## 使用场景

1. **内容过滤**：过滤掉不希望显示的内容
2. **文本风格调整**：将特定表达方式替换为更符合需求的表达
3. **添加固定签名**：在消息末尾添加特定标记或签名
4. **格式修正**：修正LLM可能输出的不规范格式

## 注意事项

1. 正则表达式规则按添加顺序依次执行
2. 添加复杂的正则表达式前建议先使用`/regex_test`命令测试效果
3. 如果插件无法正常加载，可以尝试删除配置文件，让插件重新生成默认配置

## 故障排除

如果遇到以下问题：

- **插件加载失败**：检查配置文件是否正确，尝试删除配置文件让系统重新生成
- **规则不生效**：使用`/regex_test`命令测试规则，确认正则表达式是否正确
- **插件未处理消息**：检查插件是否已启用，使用`/regex_status`命令查看状态
